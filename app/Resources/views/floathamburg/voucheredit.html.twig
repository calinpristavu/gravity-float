{% extends 'base.html.twig' %}

{% block body %}
    <h2>{{ 'edit.voucher'|trans }}</h2>

    <div class="create-voucher">
        {{ form_start(form) }}
        {{ form_errors(form) }}

        {% if app.user.canCreateOnlineVouchers %}
            {{ form_row(form.onlineVoucher, { attr: { class: "manager" } }) }}
            <div id="online_voucher_data" class="interactive hidden" data-managed-by="value_voucher_onlineVoucher">
                {{ form_row(form.orderNumber) }}
                {{ form_row(form.invoiceNumber) }}
                {{ form_row(form.includedPostalCharges) }}
                <hr>
            </div>
        {% else %}
            <div class="hidden">
                {{ form_row(form.onlineVoucher, { attr: { class: "manager" } }) }}
                <div class="interactive hidden" data-managed-by="voucher_onlineVoucher">
                    {{ form_row(form.orderNumber) }}
                    {{ form_row(form.invoiceNumber) }}
                    {{ form_row(form.includedPostalCharges) }}
                    <hr>
                </div>
            </div>
        {% endif %}
        {{ form_row(form.remainingValue) }}
        {{ form_row(form.numberOfUsers) }}
        <div class="row">
            <div class="col-md-3">
                {{ form_row(form.usages) }}
            </div>
            <div class="col-md-9">
                <div id="massage_type_div" class="interactive hidden" data-managed-by="voucher_usages_0">
                    {{ form_row(form.massage_type) }}
                </div>
                <div class="row">
                    <div id="massage_time" class="hidden col-md-offset-1 col-md-11">
                        {{ form_row(form.time_for_massage) }}
                    </div>
                </div>
                <div id="floating_time_div" class="interactive hidden" data-managed-by="voucher_usages_1">
                    {{ form_row(form.time_for_floating, {'form_group_class': {'class': 'hidden'}}) }}
                </div>
            </div>
        </div>
        {{ form_row(form.methodOfPayment) }}
        {{ form_row(form.voucherCodeLetter) }}
        {{ form_row(form.expirationDate, {attr: {future: true}}) }}
    </div>
    <br />
    <button type="submit" class="btn btn-success center-block">{{ 'edit.voucher'|trans }}</button>
    {{ form_end(form) }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('assets/js/createVoucherFormHandling.js') }}" charset="utf-8"></script>
    <script src="{{ asset('assets/js/barcode.js') }}"></script>
    <script>
        $( document ).ready(function() {
            if ($("#voucher_onlineVoucher").is(':checked')) {
                $("#online_voucher_data").removeClass("hidden");
            }

            if ($("#voucher_usages_0").is(':checked')) {
                $("#massage_type_div").removeClass("hidden");
            }

            if ($("#voucher_usages_1").is(':checked')) {
                $("#floating_time_div").removeClass("hidden");
            }

            $( "#voucher_usages_0" ).click(function() {
                if ($("#voucher_usages_0").is(':checked')) {
                    $("#voucher_massage_type_0").attr("required", true);
                    $("#voucher_massage_type_1").attr("required", false);
                } else {
                    $("#voucher_massage_type_0").attr("required", false);
                    $("#voucher_massage_type_1").attr("required", false);
                    $("#massage_time").addClass("hidden");
                }
            });

            $( "#voucher_onlineVoucher" ).click(function() {
                if ($("#voucher_onlineVoucher").is(':checked')) {
                    $("#voucher_orderNumber").attr("required", true);
                    $("#voucher_invoiceNumber").attr("required", true);
                } else {
                    $("#voucher_orderNumber").attr("required", false);
                    $("#voucher_invoiceNumber").attr("required", false);
                    $("#voucher_orderNumber").val("");
                    $("#voucher_invoiceNumber").val("");
                    $("#voucher_include_postal_charges").prop("checked", false);
                }
            });

            $( "#voucher_massage_type_0" ).click(function() {
                $("#massage_time").removeClass("hidden");
            });

            $( "#voucher_massage_type_1" ).click(function() {
                $("#massage_time").removeClass("hidden");
            });
        });
    </script>
{% endblock %}
