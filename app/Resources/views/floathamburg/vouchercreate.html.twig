{% extends 'base.html.twig' %}

{% block body %}
    {% if submitted %}
        <h2>{% trans %}voucher.preview{% endtrans %}</h2>

        <div class="create-voucher">
            <div class="row">
                <div class="col-md-8">
                    {{ 'voucher.code'|trans }}: {{ voucher.voucherCode }} <br />
                    {% if voucher.onlineVoucher %}
                        {{ 'online.voucher'|trans }} <br />
                        {{ 'voucher.order.number'|trans }}: {{ voucher.orderNumber }} <br />
                        {{ 'voucher.invoice.number'|trans }}: {{ voucher.invoiceNumber }} <br />
                        {{ 'is.included.postal.charges'|trans }}:
                        {% if voucher.includedPostalCharges %}
                            {{ 'yes'|trans }} 1.5â‚¬ <br />
                        {% else %}
                            {{ 'no'|trans }} <br />
                        {% endif %}
                    {% endif %}
                    {{ 'creation.date'|trans }}: {{ voucher.creationDate|date("m/d/Y") }} <br/>
                    {{ 'expiration.date'|trans }}: {{ voucher.expirationDate|date("m/d/Y") }} <br/>
                    {{ 'created.by'|trans }}: {{ voucher.author }} <br />
                    {{ 'created.at'|trans }}: {{ voucher.shopWhereCreated.name }} <br />
                    {{ 'number.of.users'|trans }}:
                    {% for user in voucher.numberOfUsers %}
                        {{ user }}
                    {% endfor %} <br />
                </div>
                <div class="col-md-4">
                    <svg id="barcode" data-code="{{ voucher.voucherCode }}"></svg>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ 'voucher.value'|trans }}: {{ voucher.remainingValue }} <br />
                    {{ 'voucher.method.of.payment'|trans }}: {{ voucher.methodOfPayment }} <br />
                    {{ 'can.be.used.for'|trans }}: <br />
                    {% for usage in voucher.usages %}
                        - {{ usage }} <br />
                    {% else %}
                        {{ 'no.usages.set'|trans }}
                    {% endfor %}
                    <br /><br />
                    {{ 'you.can.use.this.voucher.in.shop'|trans }}: <br />
                    {{ voucher.shopWhereCreated.name }}
                    {{ voucher.shopWhereCreated.address }} <br />
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-12 text-center">
                <a href="{{ path('voucher_save') }}" class="btn btn-success">
                    {% trans %}button.voucher.create{% endtrans %}
                </a>
                <a href="{{ path('voucher_edit') }}" class="btn btn-warning">{% trans %}edit{% endtrans %}</a>
            </div>
        </div>
    {% else %}
        <h2>{{ 'create.voucher'|trans }}</h2>

        <div class="create-voucher">
            {{ form_start(form) }}
            {{ form_errors(form) }}

            {% if app.user.canCreateOnlineVouchers %}
                {{ form_row(form.onlineVoucher, { attr: { class: "manager" } }) }}
                <div id="online_voucher_data" class="interactive hidden" data-managed-by="voucher_onlineVoucher">
                    {{ form_row(form.orderNumber) }}
                    {{ form_row(form.invoiceNumber) }}
                    {{ form_row(form.includedPostalCharges) }}
                    <hr>
                </div>
            {% else %}
                <div class="hidden">
                    {{ form_row(form.onlineVoucher, { attr: { class: "manager" } }) }}
                    <div class="interactive hidden" data-managed-by="voucher_onlineVoucher">
                        {{ form_row(form.orderNumber) }}
                        {{ form_row(form.invoiceNumber) }}
                        {{ form_row(form.includedPostalCharges) }}
                        <hr>
                    </div>
                </div>
            {% endif %}
            {{ form_row(form.remainingValue) }}
            {{ form_row(form.numberOfUsers) }}
            <div class="row">
                <div class="col-md-3">
                    {{ form_row(form.usages) }}
                </div>
                <div class="col-md-9">
                    <div id="massage_type_div" class="interactive hidden" data-managed-by="voucher_usages_0">
                        {{ form_row(form.massage_type) }}
                    </div>
                    <div class="row">
                        <div id="massage_time" class="hidden col-md-offset-1 col-md-11">
                            {{ form_row(form.time_for_massage) }}
                        </div>
                    </div>
                    <div id="floating_time_div" class="interactive hidden" data-managed-by="voucher_usages_1">
                        {{ form_row(form.time_for_floating, {'form_group_class': {'class': 'hidden'}}) }}
                    </div>
                </div>
            </div>
            {{ form_row(form.methodOfPayment) }}
            {{ form_row(form.expirationDate) }}
        </div>
        <br />
        <button type="submit" class="btn btn-success center-block">{% trans %}button.voucher.create{% endtrans %}</button>
        {{ form_end(form) }}
    {% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('assets/js/createVoucherFormHandling.js') }}" charset="utf-8"></script>
    <script src="{{ asset('assets/js/barcode.js') }}"></script>
    <script>
        $( document ).ready(function() {
            if ($("#voucher_onlineVoucher").is(':checked')) {
                $("#online_voucher_data").removeClass("hidden");
            }

            if ($("#voucher_usages_0").is(':checked')) {
                $("#massage_type_div").removeClass("hidden");
            }

            if ($("#voucher_usages_1").is(':checked')) {
                $("#floating_time_div").removeClass("hidden");
            }

            $( "#voucher_usages_0" ).click(function() {
                if ($("#voucher_usages_0").is(':checked')) {
                    $("#voucher_massage_type_0").attr("required", true);
                    $("#voucher_massage_type_1").attr("required", false);
                } else {
                    $("#voucher_massage_type_0").attr("required", false);
                    $("#voucher_massage_type_1").attr("required", false);
                    $("#massage_time").addClass("hidden");
                }
            });

            $( "#voucher_onlineVoucher" ).click(function() {
                if ($("#voucher_onlineVoucher").is(':checked')) {
                    $("#voucher_orderNumber").attr("required", true);
                    $("#voucher_invoiceNumber").attr("required", true);
                } else {
                    $("#voucher_orderNumber").attr("required", false);
                    $("#voucher_invoiceNumber").attr("required", false);
                    $("#voucher_orderNumber").val("");
                    $("#voucher_invoiceNumber").val("");
                    $("#voucher_include_postal_charges").prop("checked", false);
                }
            });

            $( "#voucher_massage_type_0" ).click(function() {
                $("#massage_time").removeClass("hidden");
            });

            $( "#voucher_massage_type_1" ).click(function() {
                $("#massage_time").removeClass("hidden");
            });
        });
    </script>
{% endblock %}
